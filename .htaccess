# Enable rewriting
RewriteEngine On
RewriteBase /leakhunter/

# Disable directory listing
Options -Indexes

# Hide server information
ServerSignature Off
ServerTokens Prod

# Security Headers
<IfModule mod_headers.c>
    Header always set X-Frame-Options DENY
    Header always set X-Content-Type-Options nosniff
    Header always set Referrer-Policy strict-origin-when-cross-origin
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data:; connect-src 'self'; frame-ancestors 'none';"
</IfModule>

# Deny access to sensitive files and directories
<FilesMatch "\.(sql|log|md|txt|bak|backup|old)$">
    Require all denied
</FilesMatch>

# Deny access to sensitive directories
RewriteRule ^(includes|logs|uploads)/ - [F,L]

# Redirect clean URLs to PHP files
RewriteRule ^login/?$ login.php [L]
RewriteRule ^dashboard/?$ admin/dashboard.php [L]
RewriteRule ^profile/?$ profile.php [L]
RewriteRule ^search/?$ search.php [L]
RewriteRule ^results/?$ results.php [L]
RewriteRule ^history/?$ history.php [L]
RewriteRule ^logs/?$ logs.php [L]
RewriteRule ^delete_search/?$ delete_search.php [L]
RewriteRule ^export/?$ export.php [L]
RewriteRule ^logout/?$ logout.php [L]

# Deny direct access to PHP files except index.php
<FilesMatch "^(config\.php|.*\.php)$">
    Require all denied
</FilesMatch>
<Files "index.php">
    Require all granted
</Files>

# Custom 404 page
ErrorDocument 404 /leakhunter/404.php
